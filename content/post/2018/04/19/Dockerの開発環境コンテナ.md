+++
title = "Dockerの開発環境コンテナ"
date = 2018-04-19T05:21:01+09:00
categories = ["技術"]
tags = ["docker", "docker-compose", "vim", "golang"]
+++
はじめに
------------------------------------------------------------------------------

Dockerで開発環境構築しようとした所感を書いています。まだ環境構築自体は完了してい
ません。

目的
------------------------------------------------------------------------------

会社で初めてMacで開発をすることがありました。それまではWindowsしかまともに触った
こともなく、自宅のPCもLinuxMintとLinux系。初めてのMacのあのポータビリティとBash
との親和性の高さ、brewには感動しました。

が、同時に苦戦することもありました。vimの環境移植が不完全だったんです。

WindowsとLinux両用のdotfilesを用意していて、今までは基本的にそれをcloneしてきて
環境構築スクリプトを叩くだけで完結していたのですが、今回はそれでもうまく行かず。
やはり周辺ツール周りやvimのバージョン違いなどがまた問題になっていたみたいでした
。

いろいろ調べたところ、+luaオプション付きのVimがどうしても入れられず。無理なら無
理でatomなりvisual-studio-codeなり代替手段はいくらでもあるのですが、この環境構築
にこれから一生付き合っていくのか、と考えると悩ましいもの。

この環境差異を吸収して、いつでも確実に自分のVim環境を整えられるようにしたいと考
えました。

DockerでVim環境構築
------------------------------------------------------------------------------

ということで、最近勉強し始めたDockerが使えるのでは、と考えました。

自分のdotfilesをcloneしてきて周辺ツールをインストールするようにしておけば、ほか
の環境に移行してもそれをcloneしてくるだけで環境が整う。しかもローカル環境を汚さ
ないので他の人のPCを借りたときにやるのも問題ない。

cloneしてくるリポジトリ内にMakefileも同封して、コンテナの起動はすべてMakefileか
ら行うようにしました。

Makefileでコマンド簡略化
------------------------------------------------------------------------------

最近個人的に気に入って使ってるやり方の一つにdocker-composeのコマンドをMakefileに
書いて実行するやりかたも使っています。下記のようなMakefileです。

```Makefile
up:
	docker-compose up -d

stop:
	docker-compose stop

clean: stop
	docker-compose rm -f

build: clean
	docker-compose build

login:
	docker exec -it workspace zsh --login
```

これで`make build up`とかやればそれだけでDockerコンテナ構築終了です。`make build
up`だとコンテナに入るのも同時に行います。依存関係を管理できるのがほんとに重宝し
てます。

ちなみにこのブログの記事作成、デプロイもMakefileで行っています。Makefile内のコマ
ンドで`hugo new`や`git push`をいくつか書いています。お手軽です。

GoInstallBinariesでエラー
------------------------------------------------------------------------------

ですが、現状構築に失敗しています。具体的にはGOPATH変数にメタキャラクタの~が入っ
ている、というエラーです。

vim-goの`:GoInstallBinaries`を実行したときに上記のエラーがでています。.bashrcに
は$HOME/goと書くようにしているのですが、なぜなのかはまだ調査中です。これを解消す
ればほぼほぼ構築が完了すると考えています。

